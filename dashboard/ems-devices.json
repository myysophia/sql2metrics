{
  "__inputs": [
    {
      "name": "DS_PROMETHEUS",
      "label": "Prometheus",
      "type": "datasource",
      "pluginId": "prometheus",
      "pluginName": "Prometheus"
    }
  ],
  "__requires": [
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "9.5.0"
    },
    {
      "type": "datasource",
      "id": "prometheus",
      "name": "Prometheus",
      "version": "1.0.0"
    },
    {
      "type": "panel",
      "id": "timeseries",
      "name": "Time series",
      "version": ""
    },
    {
      "type": "panel",
      "id": "stat",
      "name": "Stat",
      "version": ""
    }
  ],
  "title": "sql2metrics 指标概览",
  "uid": "sql2metrics-dashboard",
  "schemaVersion": 38,
  "version": 2,
  "refresh": "1m",
  "time": {
    "from": "now-24h",
    "to": "now"
  },
  "templating": {
    "list": [
      {
        "name": "region",
        "label": "区域",
        "type": "query",
        "datasource": {
          "uid": "${DS_PROMETHEUS}",
          "type": "prometheus"
        },
        "query": "label_values(energy_household_total, region)",
        "includeAll": true,
        "allValue": ".*",
        "current": {
          "text": "All",
          "value": ".*"
        },
        "multi": false,
        "refresh": 2,
        "sort": 1
      }
    ]
  },
  "panels": [
    {
      "id": 1,
      "type": "timeseries",
      "title": "户储设备趋势",
      "datasource": {
        "uid": "${DS_PROMETHEUS}",
        "type": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "lineWidth": 2
        },
        "overrides": []
      },
      "targets": [
        {
          "refId": "A",
          "expr": "energy_household_total{region=~\"$region\"}"
        },
        {
          "refId": "B",
          "expr": "energy_household_online{region=~\"$region\",status=\"online\"}"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 0
      }
    },
    {
      "id": 2,
      "type": "stat",
      "title": "户储在线率",
      "datasource": {
        "uid": "${DS_PROMETHEUS}",
        "type": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percentunit",
          "decimals": 2
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "orientation": "horizontal",
        "colorMode": "value",
        "graphMode": "none"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "clamp_min(energy_household_online{region=~\"$region\",status=\"online\"} / ignoring(status) energy_household_total{region=~\"$region\"}, 0)"
        }
      ],
      "gridPos": {
        "h": 5,
        "w": 6,
        "x": 0,
        "y": 8
      }
    },
    {
      "id": 3,
      "type": "stat",
      "title": "工商业上报率",
      "datasource": {
        "uid": "${DS_PROMETHEUS}",
        "type": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percentunit",
          "decimals": 2
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "orientation": "horizontal",
        "colorMode": "value",
        "graphMode": "none"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "clamp_min(energy_business_reporting{region=~\"$region\",status=\"reporting\"} / energy_business_total{region=~\"$region\"}, 0)"
        }
      ],
      "gridPos": {
        "h": 5,
        "w": 6,
        "x": 6,
        "y": 8
      }
    },
    {
      "id": 4,
      "type": "timeseries",
      "title": "工商业设备趋势",
      "datasource": {
        "uid": "${DS_PROMETHEUS}",
        "type": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "lineWidth": 2
        },
        "overrides": []
      },
      "targets": [
        {
          "refId": "A",
          "expr": "energy_business_total{region=~\"$region\"}"
        },
        {
          "refId": "B",
          "expr": "energy_business_reporting{region=~\"$region\",status=\"reporting\"}"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 13
      }
    },
    {
      "id": 5,
      "type": "stat",
      "title": "采集错误次数",
      "datasource": {
        "uid": "${DS_PROMETHEUS}",
        "type": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "decimals": 0
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "orientation": "horizontal",
        "colorMode": "value",
        "graphMode": "none"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "collector_errors_total"
        }
      ],
      "gridPos": {
        "h": 5,
        "w": 6,
        "x": 0,
        "y": 21
      }
    },
    {
      "id": 6,
      "type": "stat",
      "title": "最近成功时间",
      "datasource": {
        "uid": "${DS_PROMETHEUS}",
        "type": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "dateTimeAsIso",
          "decimals": 0
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "orientation": "horizontal",
        "colorMode": "value",
        "graphMode": "none"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "collector_last_success_timestamp_seconds * 1000"
        }
      ],
      "gridPos": {
        "h": 5,
        "w": 6,
        "x": 6,
        "y": 21
      }
    }
  ]
}
